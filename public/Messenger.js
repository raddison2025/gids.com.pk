Ext.namespace("Axi","Axi.UI"),Axi.Messenger=function(){if(Axi.Messenger.instance)return Axi.Messenger.instance;Axi.Messenger.instance=this,this._messages=[]},Axi.Messenger.prototype={_msgid:0,_nextMessageId:null,_container:null,_messages:null,_slideInProgress:!1,_template:new Ext.Template('<span class="x-axi-window-message x-axi-window-message-{type}">','<span class="message-column">{message}</span>','<a href="#" class="close">',"</span>"),_templateNoClose:new Ext.Template('<span class="x-axi-window-message x-axi-window-message-{type}">','<span class="message-column">{message}</span>',"</span>"),_lock:function(){this._slideInProgress=!0},_unlock:function(){this._slideInProgress=!1},_isLocked:function(){return this._slideInProgress},_createContainer:function(){var e=(Ext.DomHelper.insertFirst(document.body,{tag:"div",style:"position: absolute; left: 50%; transform: translateX(-50%); z-index: 20000;",html:'<div id="x-message-container"></div>'},!0),Ext.DomQuery.selectNode("#x-message-container"));return e||!1},_showMessage:function(e,s,t,n,i,a){if(this._isLocked())return this._showMessage.defer(10,this,arguments);var o,r;this._container||(this._container=this._createContainer()),o=a?this._templateNoClose.apply({type:s,message:e}):this._template.apply({type:s,message:e});var l=Ext.DomQuery.select(".x-axi-window-message");if(l.length){if(3===this._messages[this._messages.length-1].fxQueue.length)return n=n||++this._msgid,this._nextMessageId||(this._nextMessageId=n),this._showMessage.defer(200,this,arguments),!0;if(n&&this._nextMessageId&&this._nextMessageId!=n)return this._showMessage.defer(200,this,arguments),!0;this._nextMessageId=null,r=Ext.DomHelper.insertAfter(l[l.length-1].parentNode,{html:o},!0)}else r=Ext.DomHelper.insertFirst(this._container,{html:o},!0);if(this._messages.push(r),this._applyFx(r,t),!a){var h=new Ext.Element(Ext.DomQuery.selectNode("a.close",r.dom));h.on("click",function(e){for(var s=h.findParentNode("div"),t=this._messages.length;t>0;--t)if(this._messages[t-1]&&this._messages[t-1].dom==s){this._messages[t-1].stopFx(),this._messages[t-1].remove(),this._messages.remove(this._messages[t-1]),this._messages.length||this._unlock();break}e.preventDefault()},this)}i&&i(r)},_applyFx:function(e,s){e.slideIn("t",{callback:function(){(function(){if(!this._messages.length)return this._unlock();this._lock()}).defer(1e3*s,this)},scope:this}),e.startFx=function(t){e.pause(t||s).slideOut("t",{callback:function(){this._unlock(),this._messages.shift()},scope:this,remove:!0})}.createDelegate(this),e.cancel=function(){e.stopFx(),e.remove();for(var s=0;s<this._messages.length;++s)if(s===this._messages[s]){this._messages.splice(s,1);break}}.createDelegate(this),e.startFx()},info:function(e,s){s=s||{},this._showMessage(e,"info",s.delay||5,null,s.callback||null,s.noClose||null)},warn:function(e,s){s=s||{},this._showMessage(e,"warning",s.delay||10,null,s.callback||null,s.noClose||null)},error:function(e){this._showMessage(e,"error",10)},clearMessages:function(){for(var e=0,s=this._messages.length;e<s;++e)this._messages[e]&&this._messages[e].stopFx(),this._messages[e]&&this._messages[e].remove();this._messages=[]},getCounter:function(){return this._messages.length}},Axi.Messenger.instance,Axi.Messenger.getInstance=function(){return Axi.Messenger.instance};